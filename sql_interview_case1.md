### Scenario : 
You are given three tables namely :

1. Account which contains account_id,
2. Date which contains dateid and
3. Sales_facts with three columns namely date, account_id, and revenue
   
The Sales_facts table records the revenue generated by an account if they spend. 
If there is no spend there wont be a record in the fact table 

1. [Given a table with Account and Revenue for a month, find the max and second max revenue from that table without using MAX?](#q1)
2. [Write an SQL that generates a list of all accounts on every day in the last one month that have not been spent?](#q2)
   
### Solution :
For this case study I have used MS SQL Server 1.45.0 to execute the queries

First, we create a database named 'TestDB'

```sql
CREATE DATABASE TestDB;
```

Next, we create tables as provided by the interviewer
```sql
CREATE TABLE Account (
    account_id INT
)
;
CREATE TABLE Date (
    date_id INT, 
    date DATETIME
)
;
CREATE TABLE Sales_Fact (
    date_id INT,
    account_id INT,
    revenue FLOAT
);
```

Next, we Insert values into the above created tables
```sql
INSERT INTO Account
VALUES
    (1),
    (2),
    (3),
    (4),
    (5)
;
INSERT INTO [Date]
VALUES
    (1, '2023-01-01'),
    (2, '2023-01-02'),
    (3, '2023-01-03')
;
INSERT INTO Sales_Fact
VALUES  
    (1, 1, 100),
    (1, 2, 500),
    (2, 2, 200),
    (2, 3, 700)
```


#### Interview Questions
<a name="q1"></a>
1. Given a table with Account and Revenue for a month, find the max and second max revenue from that table without using MAX

```sql
SELECT TOP 2
account_id,
revenue
FROM Sales_Fact
ORDER BY revenue DESC;
```
<a name="q2"></a>
2. Write an SQL that generates a list of all accounts on every day in the last one month that have not been spent

```sql
-- First, we need to combine all tables as we need a list of all accounts which we get from accounts table, then we need the date table as we need to calculate for every day and finally sales_fact table as we need to filter out those accounts which have spent
SELECT 
a.account_id,    
d.date_id,
s.revenue
FROM Account a
--  full join would join the date and account table with all possible combinations of records as there is no common column between the two tables.We are doing this because we want to find for each account and for every day
FULL JOIN [Date] d
ON 1 = 1 -- run till this point, to see how full join works as a cross join in this case
-- left join is used here because we want all records from left table which is all combinations of date and account, when we join with sales_fact, it will populate the revenue column with 'NULL' values for the accounts and date combinations where there is no revenue in the sales_fact indicating that those accounts did not spent.
LEFT JOIN Sales_Fact s
ON a.account_id = s.account_id AND d.date_id = s.date_id
WHERE s.revenue IS NULL
```
Note  - In actual interview you may or may not get to see the real data or create and populate the data. This is only for the purpose of practicing and educating.
